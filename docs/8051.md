# 8051

The SMC is a 8051 microcontroller. It's an ancient and shitty design, but it gets the job done.

There's a lot of 8051 literature and tools out there already so it's up to you to find that knowledge.

## Unsorted stuff

- When descrambling the program, 0x2FF8-0x2FFB is copied to 0x0000-0x0003; whatever loads the
  program doesn't bother clearing 0x2FF8-0x2FFB afterwards
  
- All dptr reads past the end of program space return 0x01; there's nothing interesting there

## SMC gotchas

- The I/O registers, including GPIOs are different than on a "standard" 8051. See iomap.md for where they're
  located.

- TODO: movx opcode documentation; doesn't seem to do much on XSB/PSB, but is used on KSB for SFR accesses

## 8051 assembly gotchas

- The stack grows upward rather than downward, so pushes increment the stack pointer and pops decrement it.
  If you want to alter the stack pointer to make room for additional variables, put the new variables BEFORE
  the initial stack pointer, not after it.

- You can access memory cells 000h through 07Fh directly, but addresses 080h through 0FFh are reserved for
  SFRs. To read/write memory above 080h, you need to use `mov r0,#080h` to set up a pointer to the cell you
  want to access, and then `mov @r0,#0`, for example, to change the value.
